<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joelle Fitzgerald">
<meta name="dcterms.date" content="2022-10-24">

<title>Joelle_Fitzgerald_PHI_Homework</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/clipboard/clipboard.min.js"></script>
<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/quarto.js"></script>
<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/popper.min.js"></script>
<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/anchor.min.js"></script>
<link href="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Joelle_Fitzgerald_PHI_Homework_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Joelle_Fitzgerald_PHI_Homework_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Joelle_Fitzgerald_PHI_Homework_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Joelle_Fitzgerald_PHI_Homework_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Joelle_Fitzgerald_PHI_Homework</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joelle Fitzgerald </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 24, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="data-management-i-in-the-syntheticmguh-data-set" class="level2">
<h2 class="anchored" data-anchor-id="data-management-i-in-the-syntheticmguh-data-set">Data Management I in the SyntheticMGUH Data Set</h2>
<p>A clinician has collected a series of patients that they will to work with other researchers on. This collection was derived from an EMR and is present in the SyntheticMGUH database as a table called inpatientregistry.</p>
<p>Using the example framework: - Create a table that is fully de-identified to HIPAA standards - Include all dates ‘date shifted’ - Include the age at the time of admission and age at the date of death (from the original dates) - Include as much of the data as possible, without violating HIPAA! - Create a table that is de-identified as a ‘limited data set’</p>
<p>Demonstrate that your 3 tables are the same using your choice of methods. At a minimum, show that they have identical numbers of unique identifiers.</p>
<p>Techniques you will want to be familiar with (mentioned in the lecture) and review:</p>
<ul>
<li>One way cryptographic hash functions; for this exercise use the PostgreSQL function MD5()</li>
<li>Generating row numbers for SQL result sets. In PostgreSQL this is done with the “window” function of row_num() OVER () but other database often have a simpler command</li>
<li>Extraction of parts of dates - all databases do this differently, unfortunately. In PostgreSQL the commands is date_part()</li>
<li>Calculation of age; PostgreSQL has a convenient function called age()</li>
</ul>
<p>For extra credit: - Normalize the table into a patients table and an encounters table. - Create a look-up table for the description field (don’t reuse the codes from the codes table, create your own sequence.)</p>
<section id="loading-in-the-syntheticmguh-data-set" class="level4">
<h4 class="anchored" data-anchor-id="loading-in-the-syntheticmguh-data-set">Loading in the SyntheticMGUH Data Set</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)     <span class="co"># loads the tidyverse tools</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)     <span class="co"># loads the database driver for PostgreSQL</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(connections)   <span class="co"># helps RPostgres work with RStudio</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keyring)       <span class="co"># access to a local encrypted keychain for passwords</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">connection_open</span>(RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">dbname =</span> <span class="st">"syntheticMGUH2022"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">host =</span> <span class="st">"35.199.26.47"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">user =</span> <span class="st">"hids502_student"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">password =</span> <span class="fu">key_get</span>(<span class="at">service =</span> <span class="st">"syntheticmguh"</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">username =</span> <span class="st">"hids502_student"</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">bigint =</span> <span class="st">"numeric"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this to set a default connection for every SQL chunk</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># There seems to be some sort of bug in Quarto that requires this</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">connection =</span> <span class="st">"con"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hipaa-compliant-table-hipaa_inpatientregistry" class="level3">
<h3 class="anchored" data-anchor-id="hipaa-compliant-table-hipaa_inpatientregistry">HIPAA Compliant Table: ‘hipaa_inpatientregistry’</h3>
</section>
<section id="elements-to-discard-according-to-hipaa-standards" class="level3">
<h3 class="anchored" data-anchor-id="elements-to-discard-according-to-hipaa-standards">Elements to discard according to HIPAA standards</h3>
<p>Discard: - Names. - All geographic subdivisions smaller than a state, including street address, city, county, precinct, ZIP Code, and their equivalent geographical codes, except for the initial three digits of a ZIP Code if, according to the current publicly available data from the Bureau of the Census: The geographic unit formed by combining all ZIP Codes with the same three initial digits contains more than 20,000 people. - The initial three digits of a ZIP Code for all such geographic units containing 20,000 or fewer people are changed to 000. - All elements of dates (except year) for dates directly related to an individual, including birth date, admission date, discharge date, date of death; and all ages over 89 and all elements of dates (including year) indicative of such age, except that such ages and elements may be aggregated into a single category of age 90 or older. - Telephone numbers. - Facsimile numbers. - Electronic mail addresses. - Social security numbers. - Medical record numbers. - Health plan beneficiary numbers. - Account numbers. - Certificate/license numbers - Vehicle identifiers and serial numbers, including license plate numbers. - Device identifiers and serial numbers. - Web universal resource locators (URLs). - Internet protocol (IP) address numbers. - Biometric identifiers, including fingerprints and voiceprints. - Full-face photographic images and any comparable images. - Any other unique identifying number, characteristic, or code, unless otherwise permitted by the Privacy Rule for re-identification.</p>
</section>
<section id="hipaa-compliant-data-table" class="level3">
<h3 class="anchored" data-anchor-id="hipaa-compliant-data-table">HIPAA Compliant Data Table</h3>
<p>Below is a rough outline of my thought process for this assignment:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- HIPAA compliant registry ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, medical_record_id ---</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, and reasondescription are kept the same as they already follow hipaa regulation for PHI de-identification ---</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, state, encounterclass, code, description, reasoncode, reasondescription, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only the first three digits from zip code because it encodes for state which is within hipaa compliance ---</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(zip <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> zip_hipaa,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- using the first three digits from address as a random number to shift all dates --</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>) <span class="kw">as</span> date_shift_offset,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient birth date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'birthdate_hipaa' --</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> birthdate_hipaa,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient death date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'deathdate_hipaa' --</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> deathdate_hipaa,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient admission date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'admission_date_hipaa' --</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> admission_date_hipaa,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient discharge date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'discharge_date_hipaa' --</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> discharge_date_hipaa,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- using DATE_PART() function and AGE() to calculate age at admission and at death with random number from address/date_shift_offset to get hipaa compliant ages ---</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_admission,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_death</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 11%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: left;">encoded_first</th>
<th style="text-align: left;">encoded_last</th>
<th style="text-align: left;">race</th>
<th style="text-align: left;">ethnicity</th>
<th style="text-align: left;">gender</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">encounterclass</th>
<th style="text-align: right;">code</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">reasoncode</th>
<th style="text-align: left;">reasondescription</th>
<th style="text-align: right;">zip_hipaa</th>
<th style="text-align: right;">date_shift_offset</th>
<th style="text-align: left;">birthdate_hipaa</th>
<th style="text-align: left;">deathdate_hipaa</th>
<th style="text-align: left;">admission_date_hipaa</th>
<th style="text-align: left;">discharge_date_hipaa</th>
<th style="text-align: right;">age_at_admission</th>
<th style="text-align: right;">age_at_death</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">e50d4f6ce9d21e2d1f4b8fd486aef33a</td>
<td style="text-align: left;">7f15f1ad99c489dc0314952535e424d5</td>
<td style="text-align: left;">f227f96d286c1cfe749f38b952f95574</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183495009</td>
<td style="text-align: left;">Non-urgent orthopedic admission</td>
<td style="text-align: right;">4.444700e+08</td>
<td style="text-align: left;">Injury of anterior cruciate ligament</td>
<td style="text-align: right;">202</td>
<td style="text-align: right;">680</td>
<td style="text-align: left;">1994-11-28</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2021-05-17</td>
<td style="text-align: left;">2021-05-18</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">350e01b74c2c88dd0ff608a7d89e4400</td>
<td style="text-align: left;">9ed8335f97344d49af9c6d08737bdf61</td>
<td style="text-align: left;">1308c883e8ced51a2a0a7429c8e93879</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">734</td>
<td style="text-align: left;">1951-04-17</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2021-04-07</td>
<td style="text-align: left;">2021-04-08</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0ec28a4844b007289a7d97a09c072372</td>
<td style="text-align: left;">3edbf49762ebb966dfd2ad86b5fa7d3a</td>
<td style="text-align: left;">5383f77023ac243b070b9ffbe81db96f</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
<td style="text-align: right;">202</td>
<td style="text-align: right;">340</td>
<td style="text-align: left;">1960-12-11</td>
<td style="text-align: left;">2020-06-27</td>
<td style="text-align: left;">2020-06-25</td>
<td style="text-align: left;">2020-06-26</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="even">
<td style="text-align: left;">e5499889c26beb2b782125b5b5057978</td>
<td style="text-align: left;">f5ce9e493cb796c328de3d3212162d06</td>
<td style="text-align: left;">f9b39bb49a34f7223f0f451aa0b8a282</td>
<td style="text-align: left;">asian</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">103</td>
<td style="text-align: left;">1949-06-25</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-10-19</td>
<td style="text-align: left;">2019-10-20</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d0ba16ea9c69dbefaacb96b5157935a9</td>
<td style="text-align: left;">a3305e9e1754d46af1eced36dc3e71b3</td>
<td style="text-align: left;">01dc0e98199ebd7c4b947b048d51f4fd</td>
<td style="text-align: left;">native</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">166</td>
<td style="text-align: left;">1941-07-30</td>
<td style="text-align: left;">2019-08-05</td>
<td style="text-align: left;">2019-08-03</td>
<td style="text-align: left;">2019-08-04</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">78</td>
</tr>
<tr class="even">
<td style="text-align: left;">0a9fbdbdbe7c2645b756413495d49606</td>
<td style="text-align: left;">28f719c89ef7f33ce2e178490676b5ab</td>
<td style="text-align: left;">825a7f24dc90caf0c67efbd95a0355ff</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">103</td>
<td style="text-align: left;">1995-03-12</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-10-24</td>
<td style="text-align: left;">2019-10-25</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0a602f9cc6d8576b4a34fece8f91eb4a</td>
<td style="text-align: left;">29519cdb0763164fcd13519b7c603ab6</td>
<td style="text-align: left;">8843b0d05c2ef0177b1798a830df8f63</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">277</td>
<td style="text-align: left;">1962-03-21</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2020-09-16</td>
<td style="text-align: left;">2020-09-17</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: left;">ca2c3fb170e0c7cd37c56a05e0b54023</td>
<td style="text-align: left;">0cf727435451ee75d0b1ae7c5a12495a</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">587</td>
<td style="text-align: left;">1996-05-03</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2020-08-11</td>
<td style="text-align: left;">2020-08-12</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: left;">ca2c3fb170e0c7cd37c56a05e0b54023</td>
<td style="text-align: left;">0cf727435451ee75d0b1ae7c5a12495a</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">587</td>
<td style="text-align: left;">1996-05-03</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2021-04-21</td>
<td style="text-align: left;">2021-04-22</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">a43cad213eaff806fbb21c6868683548</td>
<td style="text-align: left;">c46990c86f28eec3b52d22e8cd5d1ca4</td>
<td style="text-align: left;">bcaaf96af8a32a4e3433b0893b910f7c</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
<td style="text-align: right;">202</td>
<td style="text-align: right;">640</td>
<td style="text-align: left;">1969-05-08</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2021-04-29</td>
<td style="text-align: left;">2021-04-30</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Converting data extracted above into a CTE and temporary table to be able to extract information from HIPAA-compliant data table and verify count of unique encoded_mrns have not changed from original dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- add drop table if exists to refresh temporary table created ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> hipaa_inpatientregistry_temptable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- CTE for HIPAA regulated data ---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> hipaa_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">distinct</span> medical_record_id,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, and reasondescription are kept the same as they already follow hipaa regulation for PHI de-identification ---</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, state, encounterclass, code, description, reasoncode, reasondescription, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only the first three digits from zip code because it encodes for state which is within hipaa compliance ---</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(zip <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> zip_hipaa,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- using the first three digits from address as a random number to shift all dates --</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>) <span class="kw">as</span> date_shift_offset,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient birth date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'birthdate_hipaa' --</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> birthdate_hipaa,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient death date using the first three digits of address in the same row and saving it in a new hipaa compliant date column 'deathdate_hipaa' --</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> deathdate_hipaa,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient admission date using the first three digits of address in the same row and saving it in a new hipaa compliant date column 'admission_date_hipaa' --</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> admission_date_hipaa,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient discharge date using the first three digits of address in the same row and saving it in a new hipaa compliant date column 'discharge_date_hipaa' --</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> discharge_date_hipaa,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">--- using DATE_PART() function and AGE() to calculate age at admission and at death with random number from address/date_shift_offset to get hipaa-compliant ages ---</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_admission,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_death</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">--- returning fully de-identified table ---</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">--- casting MRNs to be encoded using MD5 for each patient ---</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> md5(<span class="fu">CAST</span>(hipaa_inpatientregistry.medical_record_id <span class="kw">AS</span> TEXT)) <span class="kw">as</span> encoded_mrn,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">--- filtering out patient ages and dates that indicate a patient is 90 or older using CASE ---</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_admission,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span> </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_death, encoded_first, encoded_last, admission_date_hipaa, discharge_date_hipaa, zip_hipaa, hipaa_inpatientregistry.race, hipaa_inpatientregistry.ethnicity, hipaa_inpatientregistry.gender, hipaa_inpatientregistry.state, hipaa_inpatientregistry.encounterclass, hipaa_inpatientregistry.code, hipaa_inpatientregistry.description, hipaa_inpatientregistry.reasoncode, hipaa_inpatientregistry.reasondescription</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">--- creating a temporary table to hold de-identified patient data ---</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> hipaa_inpatientregistry_temptable</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hipaa_inpatientregistry </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">--- joining inpatientregistry and hipaa_inpatientregistry on medical_record_id to be able to filter and shift dates in the hipaa_inpatientregistry table to be HIPAA compliant ---</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> inpatientregistry <span class="kw">on</span> hipaa_inpatientregistry.medical_record_id <span class="op">=</span> inpatientregistry.medical_record_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> encoded_mrn, encoded_first, encoded_last, age_at_admission, age_at_death, admission_date_hipaa, discharge_date_hipaa, zip_hipaa, race, ethnicity, gender, state, code, encounterclass, description, reasoncode, reasondescription</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hipaa_inpatientregistry_temptable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 3%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: left;">encoded_first</th>
<th style="text-align: left;">encoded_last</th>
<th style="text-align: right;">age_at_admission</th>
<th style="text-align: right;">age_at_death</th>
<th style="text-align: left;">admission_date_hipaa</th>
<th style="text-align: left;">discharge_date_hipaa</th>
<th style="text-align: right;">zip_hipaa</th>
<th style="text-align: left;">race</th>
<th style="text-align: left;">ethnicity</th>
<th style="text-align: left;">gender</th>
<th style="text-align: left;">state</th>
<th style="text-align: right;">code</th>
<th style="text-align: left;">encounterclass</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">reasoncode</th>
<th style="text-align: left;">reasondescription</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">7fddef66a00bb526aa206947141011cf</td>
<td style="text-align: left;">aa11241a42ab9e1502d7a46c9d1da19a</td>
<td style="text-align: left;">024cf0d3e52ffe1f609cd7e1d7794d28</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2021-08-17</td>
<td style="text-align: left;">2021-08-18</td>
<td style="text-align: right;">204</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.54837e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">24742255395f67dd9f414b21239808e9</td>
<td style="text-align: left;">0af897fb9074160975a15d4c28e4b217</td>
<td style="text-align: left;">1dfde618348ea48884a4f19fff05ed2a</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2020-03-13</td>
<td style="text-align: left;">2020-03-14</td>
<td style="text-align: right;">205</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.54837e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">61fe7de63a2004b40471912517082b06</td>
<td style="text-align: left;">e68564f23e0e939acea76dc3d2bc01bf</td>
<td style="text-align: left;">a6033f92de642c02bc33a5067157aee8</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2020-11-08</td>
<td style="text-align: left;">2020-11-09</td>
<td style="text-align: right;">203</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.24171e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="even">
<td style="text-align: left;">61fe7de63a2004b40471912517082b06</td>
<td style="text-align: left;">e68564f23e0e939acea76dc3d2bc01bf</td>
<td style="text-align: left;">a6033f92de642c02bc33a5067157aee8</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2020-11-08</td>
<td style="text-align: left;">2020-11-09</td>
<td style="text-align: right;">203</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.24171e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">61fe7de63a2004b40471912517082b06</td>
<td style="text-align: left;">e68564f23e0e939acea76dc3d2bc01bf</td>
<td style="text-align: left;">a6033f92de642c02bc33a5067157aee8</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2021-02-25</td>
<td style="text-align: left;">2021-02-26</td>
<td style="text-align: right;">203</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.24171e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="even">
<td style="text-align: left;">61fe7de63a2004b40471912517082b06</td>
<td style="text-align: left;">e68564f23e0e939acea76dc3d2bc01bf</td>
<td style="text-align: left;">a6033f92de642c02bc33a5067157aee8</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2021-02-25</td>
<td style="text-align: left;">2021-02-26</td>
<td style="text-align: right;">203</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.24171e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8952ee305e2b4b172efa0c980ac0c210</td>
<td style="text-align: left;">bf4cfbc5a25f917dd3179a250298e362</td>
<td style="text-align: left;">34458761f3ff52863a828c12ed403b52</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">88</td>
<td style="text-align: left;">2019-08-30</td>
<td style="text-align: left;">2019-08-31</td>
<td style="text-align: right;">205</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">hispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.54837e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">d20314ffe5ba9b3e4a89b0ab901df66f</td>
<td style="text-align: left;">b4d7e4d0625cce8e91f540a838bc298c</td>
<td style="text-align: left;">3415c6db37db38dd521433bb52174fbe</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2021-09-11</td>
<td style="text-align: left;">2021-09-12</td>
<td style="text-align: right;">200</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.54837e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eb8d5ccd35b1b80b9d2b79693606bcc9</td>
<td style="text-align: left;">6b4939112a7c911becf7ad37caf9b8b1</td>
<td style="text-align: left;">53d417d757008832d7f5f4de5d96709c</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2021-05-13</td>
<td style="text-align: left;">2021-05-14</td>
<td style="text-align: right;">203</td>
<td style="text-align: left;">asian</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.54837e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: left;">ca2c3fb170e0c7cd37c56a05e0b54023</td>
<td style="text-align: left;">0cf727435451ee75d0b1ae7c5a12495a</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">2020-08-11</td>
<td style="text-align: left;">2020-08-12</td>
<td style="text-align: right;">200</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.24171e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- ensuring count of unique medical record ids in de-identified table matches original dataset ---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">distinct</span> encoded_mrn) <span class="kw">as</span> encoded_mrn_hipaa_table, <span class="fu">COUNT</span>(<span class="kw">distinct</span> medical_record_id) <span class="kw">as</span> medical_record_id_original</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hipaa_inpatientregistry_temptable, inpatientregistry </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">encoded_mrn_hipaa_table</th>
<th style="text-align: right;">medical_record_id_original</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">311</td>
<td style="text-align: right;">311</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="limited-data-table" class="level3">
<h3 class="anchored" data-anchor-id="limited-data-table">Limited Data Table</h3>
</section>
<section id="elements-to-include-in-a-limited-dataset" class="level3">
<h3 class="anchored" data-anchor-id="elements-to-include-in-a-limited-dataset">Elements to include in a limited dataset</h3>
<p>Keep: - Locations - Dates Discard/Encode: - All other identifiers are stripped or encoded from dataset</p>
<p>Below is a rough extraction of the data I will want for the limited dataset table from original data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Limited dataset --</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">--- a limited date set encoded/stripped except for dates and location ---</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>birthdate <span class="kw">as</span> birthdate_limited,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>deathdate <span class="kw">as</span> deathdate_limited,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>admission_date <span class="kw">as</span> admission_date_limited,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="kw">as</span> discharge_date_limited,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">--- age at admission --</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date, birthdate)) <span class="kw">as</span> age_at_admission,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate, birthdate)) <span class="kw">as</span> age_at_death, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, reasondescription, and locations (state, county, city, address, zip) are kept the same as they are included in a limited data set ---</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, address, city, state, county, zip, encounterclass, code, description, reasoncode, reasondescription</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 8%">
<col style="width: 2%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">birthdate_limited</th>
<th style="text-align: left;">deathdate_limited</th>
<th style="text-align: left;">admission_date_limited</th>
<th style="text-align: left;">discharge_date_limited</th>
<th style="text-align: right;">age_at_admission</th>
<th style="text-align: right;">age_at_death</th>
<th style="text-align: left;">encoded_first</th>
<th style="text-align: left;">encoded_last</th>
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: left;">race</th>
<th style="text-align: left;">ethnicity</th>
<th style="text-align: left;">gender</th>
<th style="text-align: left;">address</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">county</th>
<th style="text-align: right;">zip</th>
<th style="text-align: left;">encounterclass</th>
<th style="text-align: right;">code</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">reasoncode</th>
<th style="text-align: left;">reasondescription</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1993-01-17</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-07</td>
<td style="text-align: left;">2019-07-08</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">7f15f1ad99c489dc0314952535e424d5</td>
<td style="text-align: left;">f227f96d286c1cfe749f38b952f95574</td>
<td style="text-align: left;">e50d4f6ce9d21e2d1f4b8fd486aef33a</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">680 Feil Camp Suite 30</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20230</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183495009</td>
<td style="text-align: left;">Non-urgent orthopedic admission</td>
<td style="text-align: right;">4.444700e+08</td>
<td style="text-align: left;">Injury of anterior cruciate ligament</td>
</tr>
<tr class="even">
<td style="text-align: left;">1949-04-13</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-04-04</td>
<td style="text-align: left;">2019-04-05</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">9ed8335f97344d49af9c6d08737bdf61</td>
<td style="text-align: left;">1308c883e8ced51a2a0a7429c8e93879</td>
<td style="text-align: left;">350e01b74c2c88dd0ff608a7d89e4400</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">734 Balistreri Key Apt 10</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20003</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1960-01-06</td>
<td style="text-align: left;">2019-07-23</td>
<td style="text-align: left;">2019-07-21</td>
<td style="text-align: left;">2019-07-22</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">59</td>
<td style="text-align: left;">3edbf49762ebb966dfd2ad86b5fa7d3a</td>
<td style="text-align: left;">5383f77023ac243b070b9ffbe81db96f</td>
<td style="text-align: left;">0ec28a4844b007289a7d97a09c072372</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">340 Wiegand Flat</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20202</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">1949-03-14</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">f5ce9e493cb796c328de3d3212162d06</td>
<td style="text-align: left;">f9b39bb49a34f7223f0f451aa0b8a282</td>
<td style="text-align: left;">e5499889c26beb2b782125b5b5057978</td>
<td style="text-align: left;">asian</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">1031 Raynor Wynd Apt 36</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20015</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1941-02-14</td>
<td style="text-align: left;">2019-02-20</td>
<td style="text-align: left;">2019-02-18</td>
<td style="text-align: left;">2019-02-19</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">a3305e9e1754d46af1eced36dc3e71b3</td>
<td style="text-align: left;">01dc0e98199ebd7c4b947b048d51f4fd</td>
<td style="text-align: left;">d0ba16ea9c69dbefaacb96b5157935a9</td>
<td style="text-align: left;">native</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">166 Friesen Tunnel Suite 28</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20002</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994-11-29</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-13</td>
<td style="text-align: left;">2019-07-14</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">28f719c89ef7f33ce2e178490676b5ab</td>
<td style="text-align: left;">825a7f24dc90caf0c67efbd95a0355ff</td>
<td style="text-align: left;">0a9fbdbdbe7c2645b756413495d49606</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">1030 Cummerata Gateway Suite 63</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1961-06-17</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-12-14</td>
<td style="text-align: left;">2019-12-15</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">29519cdb0763164fcd13519b7c603ab6</td>
<td style="text-align: left;">8843b0d05c2ef0177b1798a830df8f63</td>
<td style="text-align: left;">0a602f9cc6d8576b4a34fece8f91eb4a</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">277 Watsica Esplanade Suite 7</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20551</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994-09-24</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-01-02</td>
<td style="text-align: left;">2019-01-03</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">ca2c3fb170e0c7cd37c56a05e0b54023</td>
<td style="text-align: left;">0cf727435451ee75d0b1ae7c5a12495a</td>
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">587 Kling Flat Unit 21</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20037</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1994-09-24</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-09-12</td>
<td style="text-align: left;">2019-09-13</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">ca2c3fb170e0c7cd37c56a05e0b54023</td>
<td style="text-align: left;">0cf727435451ee75d0b1ae7c5a12495a</td>
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">587 Kling Flat Unit 21</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20037</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="even">
<td style="text-align: left;">1967-08-07</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-29</td>
<td style="text-align: left;">2019-07-30</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">c46990c86f28eec3b52d22e8cd5d1ca4</td>
<td style="text-align: left;">bcaaf96af8a32a4e3433b0893b910f7c</td>
<td style="text-align: left;">a43cad213eaff806fbb21c6868683548</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">640 Dach Frontage road</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">20240</td>
<td style="text-align: left;">inpatient</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Converting limited patient dataset to a CTE and verifying ‘encoded_mrn’ count matches original dataset and HIPAA dataset from the previous query:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- add drop table if exists to refresh temporary table created ---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> limited_inpatientregistry_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- CTE for limited dataset --</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> limited_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">--- a limited date set encoded/stripped except for dates and location ---</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>birthdate <span class="kw">as</span> birthdate_limited,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>deathdate <span class="kw">as</span> deathdate_limited,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>admission_date <span class="kw">as</span> admission_date_limited,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="kw">as</span> discharge_date_limited,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">--- age at admission --</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date, birthdate)) <span class="kw">as</span> age_at_admission,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate, birthdate)) <span class="kw">as</span> age_at_death, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, reasondescription, and locations (state, county, city, address, zip) are kept the same as they are included in a limited data set ---</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, address, city, state, county, zip, encounterclass, code, description, reasoncode, reasondescription</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- returning limited data table ---</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> encoded_mrn, age_at_admission, age_at_death, birthdate_limited, deathdate_limited, admission_date_limited, discharge_date_limited, zip, race, ethnicity, gender, state, code, description, reasoncode, reasondescription</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">--- creating a temporary table to hold limited patient dataset ---</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> limited_inpatientregistry_table</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> limited_inpatientregistry </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> limited_inpatientregistry_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 12%">
<col style="width: 4%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: right;">age_at_admission</th>
<th style="text-align: right;">age_at_death</th>
<th style="text-align: left;">birthdate_limited</th>
<th style="text-align: left;">deathdate_limited</th>
<th style="text-align: left;">admission_date_limited</th>
<th style="text-align: left;">discharge_date_limited</th>
<th style="text-align: right;">zip</th>
<th style="text-align: left;">race</th>
<th style="text-align: left;">ethnicity</th>
<th style="text-align: left;">gender</th>
<th style="text-align: left;">state</th>
<th style="text-align: right;">code</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">reasoncode</th>
<th style="text-align: left;">reasondescription</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">e50d4f6ce9d21e2d1f4b8fd486aef33a</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1993-01-17</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-07</td>
<td style="text-align: left;">2019-07-08</td>
<td style="text-align: right;">20230</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183495009</td>
<td style="text-align: left;">Non-urgent orthopedic admission</td>
<td style="text-align: right;">4.444700e+08</td>
<td style="text-align: left;">Injury of anterior cruciate ligament</td>
</tr>
<tr class="even">
<td style="text-align: left;">350e01b74c2c88dd0ff608a7d89e4400</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1949-04-13</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-04-04</td>
<td style="text-align: left;">2019-04-05</td>
<td style="text-align: right;">20003</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0ec28a4844b007289a7d97a09c072372</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">59</td>
<td style="text-align: left;">1960-01-06</td>
<td style="text-align: left;">2019-07-23</td>
<td style="text-align: left;">2019-07-21</td>
<td style="text-align: left;">2019-07-22</td>
<td style="text-align: right;">20202</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">e5499889c26beb2b782125b5b5057978</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1949-03-14</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: right;">20015</td>
<td style="text-align: left;">asian</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d0ba16ea9c69dbefaacb96b5157935a9</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">78</td>
<td style="text-align: left;">1941-02-14</td>
<td style="text-align: left;">2019-02-20</td>
<td style="text-align: left;">2019-02-18</td>
<td style="text-align: left;">2019-02-19</td>
<td style="text-align: right;">20002</td>
<td style="text-align: left;">native</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">308540004</td>
<td style="text-align: left;">Inpatient stay (finding)</td>
<td style="text-align: right;">8.880501e+07</td>
<td style="text-align: left;">Chronic congestive heart failure (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">0a9fbdbdbe7c2645b756413495d49606</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1994-11-29</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-13</td>
<td style="text-align: left;">2019-07-14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0a602f9cc6d8576b4a34fece8f91eb4a</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1961-06-17</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-12-14</td>
<td style="text-align: left;">2019-12-15</td>
<td style="text-align: right;">20551</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
<tr class="even">
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1994-09-24</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-01-02</td>
<td style="text-align: left;">2019-01-03</td>
<td style="text-align: right;">20037</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8eb03c3e40b0c2b9d05b3a050e8da3cd</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1994-09-24</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-09-12</td>
<td style="text-align: left;">2019-09-13</td>
<td style="text-align: right;">20037</td>
<td style="text-align: left;">white</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">183452005</td>
<td style="text-align: left;">Encounter Inpatient</td>
<td style="text-align: right;">1.241710e+14</td>
<td style="text-align: left;">Chronic intractable migraine without aura</td>
</tr>
<tr class="even">
<td style="text-align: left;">a43cad213eaff806fbb21c6868683548</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1967-08-07</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2019-07-29</td>
<td style="text-align: left;">2019-07-30</td>
<td style="text-align: right;">20240</td>
<td style="text-align: left;">black</td>
<td style="text-align: left;">nonhispanic</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">District of Columbia</td>
<td style="text-align: right;">310061009</td>
<td style="text-align: left;">Gynecology service (qualifier value)</td>
<td style="text-align: right;">2.548370e+08</td>
<td style="text-align: left;">Malignant neoplasm of breast (disorder)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- CTE for limited dataset --</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> limited_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">--- a limited date set encoded/stripped except for dates and location ---</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>birthdate <span class="kw">as</span> birthdate_limited,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>deathdate <span class="kw">as</span> deathdate_limited,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>admission_date <span class="kw">as</span> admission_date_limited,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="kw">as</span> discharge_date_limited,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">--- age at admission --</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date, birthdate)) <span class="kw">as</span> age_at_admission,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate, birthdate)) <span class="kw">as</span> age_at_death, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, reasondescription, and locations (state, county, city, address, zip) are kept the same as they are included in a limited data set ---</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, address, city, state, county, zip, encounterclass, code, description, reasoncode, reasondescription</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- returning count of unique encoded_mrn from limited dataset against original dataset count ---</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">distinct</span> encoded_mrn) <span class="kw">as</span> encoded_mrn_limited_table, <span class="fu">COUNT</span>(<span class="kw">distinct</span> medical_record_id) <span class="kw">as</span> medical_record_id_original</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> limited_inpatientregistry, inpatientregistry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">encoded_mrn_limited_table</th>
<th style="text-align: right;">medical_record_id_original</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">311</td>
<td style="text-align: right;">311</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="demonstrate-that-your-3-tables-are-the-same-using-your-choice-of-methods.-at-a-minimum-show-that-they-have-identical-numbers-of-unique-identifiers." class="level3">
<h3 class="anchored" data-anchor-id="demonstrate-that-your-3-tables-are-the-same-using-your-choice-of-methods.-at-a-minimum-show-that-they-have-identical-numbers-of-unique-identifiers.">Demonstrate that your 3 tables are the same using your choice of methods. At a minimum, show that they have identical numbers of unique identifiers.</h3>
<p>Combining HIPAA and limited datasets with original table to ensure all tables have the same unique identifiers. I will do this by joining all CTEs/tables with a UNION statement returning the count of unique encoded MRNs and number of rows for each table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> hipaa_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, and reasondescription are kept the same as they already follow hipaa regulation for PHI de-identification ---</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, state, encounterclass, code, description, reasoncode, reasondescription, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only the first three digits from zip code because it encodes for state which is within hipaa compliance ---</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(zip <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> zip_hipaa,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- using the first three digits from address as a random number to shift all dates --</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>) <span class="kw">as</span> date_shift_offset,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient birth date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'birthdate_hipaa' --</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> birthdate_hipaa,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient death date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'deathdate_hipaa' --</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> deathdate_hipaa,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient admission date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'admission_date_hipaa' --</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> admission_date_hipaa,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient discharge date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'discharge_date_hipaa' --</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> discharge_date_hipaa,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- using DATE_PART() function and AGE() to calculate age at admission and at death with random number from address/date_shift_offset to get hipaa compliant ages ---</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_admission,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_death</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>) ,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">-- Limited dataset --</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a> limited_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co">--- a limited date set encoded/stripped except for dates and location ---</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>birthdate <span class="kw">as</span> birthdate_limited,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>deathdate <span class="kw">as</span> deathdate_limited,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>admission_date <span class="kw">as</span> admission_date_limited,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="kw">as</span> discharge_date_limited,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co">--- age at admission --</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date, birthdate)) <span class="kw">as</span> age_at_admission,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate, birthdate)) <span class="kw">as</span> age_at_death, </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, md5(<span class="fu">CAST</span>(medical_record_id <span class="kw">AS</span> TEXT)) encoded_mrn, </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, reasondescription, and locations (state, county, city, address, zip) are kept the same as they are included in a limited data set ---</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, address, city, state, county, zip, encounterclass, code, description, reasoncode, reasondescription</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting non-HIPAA compliant 'inpatientregistry' dataset into a temporary table and returning the number of rows and distinct MRNs as 'original_patients' ---</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">'inpatientregistry'</span> <span class="kw">as</span> <span class="kw">table</span>,  </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="kw">rows</span>, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> medical_record_id) <span class="kw">AS</span> original_patients</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="co">--- setting union statement to combine 'inpatientregistry' with new hipaa_inpatientregistry CTE ---</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting HIPAA compliant 'hipaa_inpatientregistry' dataset into a temporary table and returning the number of rows and distinct MRNs as 'hipaa_patients' ---</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'hipaa_inpatientregistry'</span> <span class="kw">as</span> <span class="kw">table</span>, </span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="kw">rows</span>, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> encoded_mrn) <span class="kw">AS</span> hipaa_patients</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a> <span class="kw">FROM</span> hipaa_inpatientregistry</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="co">--- setting union statement to combine 'hipaa_inpatientregistry' and 'inpatientregistry' with new limited_inpatientregistry CTE ---</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting HIPAA compliant 'hipaa_inpatientregistry' dataset into a temporary table and returning the number of rows and distinct MRNs as 'limited_patients' ---</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">'limited_inpatientregistry'</span> <span class="kw">as</span> <span class="kw">table</span>,</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="kw">rows</span>, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> encoded_mrn) <span class="kw">AS</span> limited_patients</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> limited_inpatientregistry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">table</th>
<th style="text-align: right;">rows</th>
<th style="text-align: right;">original_patients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">inpatientregistry</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">311</td>
</tr>
<tr class="even">
<td style="text-align: left;">limited_inpatientregistry</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">311</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hipaa_inpatientregistry</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">311</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="normalization" class="level3">
<h3 class="anchored" data-anchor-id="normalization">Normalization</h3>
<p>Attempted normalization. I split the encounter and patient information into two different look-up tables, however, there are still duplicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- add drop table if exists to refresh temporary table created ---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> patient_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> hipaa_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>medical_record_id, md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, and reasondescription are kept the same as they already follow hipaa regulation for PHI de-identification ---</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, state, encounterclass, code, description, reasoncode, reasondescription, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only the first three digits from zip code because it encodes for state which is within hipaa compliance ---</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(zip <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> zip_hipaa,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- using the first three digits from address as a random number to shift all dates --</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>) <span class="kw">as</span> date_shift_offset,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient birth date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'birthdate_hipaa' --</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> birthdate_hipaa,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient death date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'deathdate_hipaa' --</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> deathdate_hipaa,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient admission date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'admission_date_hipaa' --</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> admission_date_hipaa,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient discharge date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'discharge_date_hipaa' --</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> discharge_date_hipaa,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- using DATE_PART() function and AGE() to calculate age at admission and at death with random number from address/date_shift_offset to get hipaa compliant ages ---</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_admission,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_death</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>) ,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>filtered_age <span class="kw">as</span> (</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> md5(<span class="fu">CAST</span>(hipaa_inpatientregistry.medical_record_id <span class="kw">AS</span> TEXT)) <span class="kw">as</span> encoded_mrn,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">--- filtering out patient ages and dates that indicate a patient is 90 or older using CASE ---</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_admission,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span> </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_death, admission_date_hipaa, discharge_date_hipaa, zip_hipaa</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hipaa_inpatientregistry </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">--- joining inpatientregistry and hipaa_inpatientregistry on medical_record_id to be able to filter and shift dates in the hipaa_inpatientregistry table to be HIPAA compliant ---</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> inpatientregistry <span class="kw">on</span> hipaa_inpatientregistry.medical_record_id <span class="op">=</span> inpatientregistry.medical_record_id</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting patient data ---</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> encoded_mrn, filtered_age.age_at_admission, filtered_age.age_at_death, zip_hipaa, race, ethnicity, gender, state, code</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">-- adding patient data to new patient look-up data table ---</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> patient_lookup</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry, filtered_age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only distinct patients in patient look-up table ---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">distinct</span> encoded_mrn, age_at_admission</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> patient_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: right;">age_at_admission</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0a43a233b39493c9778fb53e3c9504d2</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">c8792486c8638d9226a9d78710b990a4</td>
<td style="text-align: right;">68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2a8196c36ab972b5aac3d7580892bedc</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">e472292e4986f09001d96e10862e1f15</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8bca6bb6c5547852d854f8017794f770</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="even">
<td style="text-align: left;">61fe7de63a2004b40471912517082b06</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a0ed2ee73211ac8a0e7f1e0f6f753f23</td>
<td style="text-align: right;">71</td>
</tr>
<tr class="even">
<td style="text-align: left;">032cee184d373c77a36f220f0d5b1546</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">eba1a6633bb6d8820737f8de520dc09d</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="even">
<td style="text-align: left;">0a8c2eda1d9042ca7ab88e18bfb0d424</td>
<td style="text-align: right;">43</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- add drop table if exists to refresh temporary table created ---</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> encounter_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> hipaa_inpatientregistry <span class="kw">AS</span> (</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">--- using MD5 hash to encode patient first name, last name, distinct medical_record_id ---</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>medical_record_id, md5(<span class="fu">first</span>) <span class="kw">as</span> encoded_first, md5(<span class="fu">last</span>) <span class="kw">as</span> encoded_last, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">--- race, ethnicity, encounterclass, code, description, reasoncode, and reasondescription are kept the same as they already follow hipaa regulation for PHI de-identification ---</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>race, ethnicity, gender, state, encounterclass, code, description, reasoncode, reasondescription, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting only the first three digits from zip code because it encodes for state which is within hipaa compliance ---</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(zip <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> zip_hipaa,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- using the first three digits from address as a random number to shift all dates --</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>) <span class="kw">as</span> date_shift_offset,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient birth date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'birthdate_hipaa' --</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> birthdate_hipaa,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient death date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'deathdate_hipaa' --</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> deathdate_hipaa,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient admission date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'admission_date_hipaa' --</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> admission_date_hipaa,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">--- date shifting patient discharge date using the first three digits of address in the same row and saving it in a new hipaa compliant column 'discharge_date_hipaa' --</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>discharge_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)) <span class="kw">as</span> discharge_date_hipaa,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">--- using DATE_PART() function and AGE() to calculate age at admission and at death with random number from address/date_shift_offset to get hipaa compliant ages ---</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_admission,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">-- age at death --</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="kw">as</span> age_at_death</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>) ,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>filtered_age <span class="kw">as</span> (</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> md5(<span class="fu">CAST</span>(hipaa_inpatientregistry.medical_record_id <span class="kw">AS</span> TEXT)) <span class="kw">as</span> encoded_mrn,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">--- filtering out patient ages and dates that indicate a patient is 90 or older using CASE ---</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(admission_date <span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_admission,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>   <span class="cf">CASE</span> <span class="cf">WHEN</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="op">&gt;=</span> <span class="dv">89</span> <span class="cf">THEN</span> <span class="dv">89</span> </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>     <span class="cf">ELSE</span> DATE_PART(<span class="st">'year'</span>, age(deathdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)), birthdate<span class="op">+</span>(<span class="fu">CAST</span>(<span class="kw">LEFT</span>(<span class="fu">CAST</span>(address <span class="kw">AS</span> <span class="dt">VARCHAR</span>),<span class="dv">3</span>) <span class="kw">AS</span> <span class="dt">INT</span>)))) <span class="cf">END</span> <span class="kw">as</span> age_at_death, admission_date_hipaa, discharge_date_hipaa, zip_hipaa</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hipaa_inpatientregistry </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">--- joining inpatientregistry and hipaa_inpatientregistry on medical_record_id to be able to filter and shift dates in the hipaa_inpatientregistry table to be HIPAA compliant ---</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> inpatientregistry <span class="kw">on</span> hipaa_inpatientregistry.medical_record_id <span class="op">=</span> inpatientregistry.medical_record_id</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting encounter data from hipaa table ---</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> encoded_mrn, admission_date_hipaa, discharge_date_hipaa, encounterclass, code, description, reasoncode, reasondescription</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co">-- adding data to new encounter look-up table --</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> encounter_lookup</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> inpatientregistry, filtered_age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">--- selecting distinct mrns per encounter in encounter look-up table ---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">distinct</span> encoded_mrn, encounterclass</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> encounter_lookup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="knitsql-table">
<table class="table table-sm table-striped">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">encoded_mrn</th>
<th style="text-align: left;">encounterclass</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">eec23bc03e1e1aa56b6a122ac09c418c</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="even">
<td style="text-align: left;">05f1678a3944bc625616e7f1496aeffd</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b41b2e5d7cebfa11ea67994c4b8c15e1</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="even">
<td style="text-align: left;">24742255395f67dd9f414b21239808e9</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bd6a1d17221463338bab8b55fb4bdb8b</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="even">
<td style="text-align: left;">ee6091cb90934e2305549508b26d89ee</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1942a8fb7b566b7039f05cec36136756</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="even">
<td style="text-align: left;">eba1a6633bb6d8820737f8de520dc09d</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="odd">
<td style="text-align: left;">96376576357787fea969472f656744d5</td>
<td style="text-align: left;">inpatient</td>
</tr>
<tr class="even">
<td style="text-align: left;">2b4b40224646a07dcfd98b6b854ea6e5</td>
<td style="text-align: left;">inpatient</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>